<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Life of Lotus</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500&family=Brygada+1918:wght@400;500&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- Header -->
  <header class="header">
    <div class="logo">Life of Lotus</div>
    <div class="header-mobile-actions">
      <button class="hamburger" id="hamburger" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="nav" id="nav">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="index.html#pricing">Pricing</a>
      <a href="index.html#areas">Our Services</a>
      <a href="index.html#faq">FAQ</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </header>

  <!-- Intake Section -->
  <section class="intake">
    <div class="intake-container">
      <form class="intake-form" id="intake-form">
        <div class="intake-grid">
          
          <!-- First Section: Pricing Card -->
          <div class="intake-section">
            <div class="pricing-card">
              <div class="pricing-duration">60-Minutes</div>
              <h3 class="pricing-name">Deep Insight</h3>
              <div class="pricing-best-for">Root-cause analysis | First-time consultations</div>
              <div class="pricing-toggle">
                <button type="button" class="toggle-btn active" data-type="audio">Audio</button>
                <button type="button" class="toggle-btn" data-type="video">Video</button>
              </div>
              <div class="pricing-price" data-audio-price="₹1,800" data-video-price="₹2,000">₹1,800</div>
              <div class="pricing-details">
                <div class="pricing-detail-item">Up to 3 related topics allowed</div>
                <div class="pricing-detail-item">2 charts covered</div>
              </div>
            </div>
          </div>

          <!-- Second Section: Personal Information -->
          <div class="intake-section">
            <div class="field">
              <label>First Name *</label>
              <input type="text" name="firstName" required />
            </div>

            <div class="field">
              <label>Last Name *</label>
              <input type="text" name="lastName" required />
            </div>

            <div class="field">
              <label>Phone Number *</label>
              <input type="tel" name="phone" required />
            </div>

            <div class="field">
              <label>Email ID *</label>
              <input type="email" name="email" required />
            </div>
          </div>

          <!-- Third Section: Birth Details -->
          <div class="intake-section">
            <div class="field">
              <label>Date of Birth *</label>
              <input type="date" name="dob" required />
            </div>

            <div class="field">
              <label>Time of Birth *</label>
              <input type="time" name="tob" required />
            </div>

            <div class="field">
              <label>Place of Birth *</label>
              <div class="autocomplete-wrapper">
                <input type="text" name="pob" id="place-of-birth" autocomplete="off" required />
                <div class="autocomplete-suggestions" id="place-suggestions"></div>
              </div>
            </div>

            <div class="field">
              <label>Primary Area of Guidance *</label>
              <select name="area" required>
                <option value="">Select an area</option>
                <option>Career & Finances</option>
                <option>Marriage & Relationships</option>
                <option>Health & Wellbeing</option>
                <option>Family & Children</option>
                <option>Personal / Spiritual Growth</option>
                <option>Open session</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Optional Section -->
        <div class="intake-optional">
          <div class="field">
            <label>What feels most unclear right now? (Optional)</label>
            <textarea name="unclear" rows="4"></textarea>
          </div>
        </div>

        <!-- CTA Button -->
        <div class="intake-cta-wrapper">
          <button class="cta" type="button" id="book-slot-btn">
            Book Slot
          </button>
        </div>
      </form>

      <!-- Calendly Section (hidden initially) -->
      <div class="calendly-section" id="calendly-section" style="display: none;">
        <h2 class="calendly-heading">Select your preferred slot</h2>
        <p class="calendly-note-item"><strong>Please note:</strong> Select your time zone before booking. The selected slot indicates the session start time. Session duration depends on the service you choose.</p>
        <div class="calendly-inline-widget" data-url="https://calendly.com/saumyasingh-2403/lifeoflotus" style="min-width:320px;height:700px;"></div>
      </div>
    </div>
  </section>

  <script>
    // Toggle button functionality with price updates
    document.querySelectorAll('.toggle-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const toggleGroup = this.parentElement;
        const card = toggleGroup.closest('.pricing-card, .package-card');
        const isVideo = this.dataset.type === 'video';
        
        // Update toggle active state
        toggleGroup.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // Update pricing card prices
        if (card && card.classList.contains('pricing-card')) {
          const priceElement = card.querySelector('.pricing-price');
          if (priceElement) {
            const audioPrice = priceElement.dataset.audioPrice;
            const videoPrice = priceElement.dataset.videoPrice;
            if (audioPrice && videoPrice) {
              priceElement.textContent = isVideo ? videoPrice : audioPrice;
            }
          }
        }
      });
    });

    // Book Slot button - show Calendly
    document.getElementById('book-slot-btn').addEventListener('click', function() {
      // Validate form first
      const form = document.getElementById('intake-form');
      if (form.checkValidity()) {
        // Hide form
        document.querySelector('.intake-form').style.display = 'none';
        // Show Calendly section
        const calendlySection = document.getElementById('calendly-section');
        calendlySection.style.display = 'block';
        // Load Calendly widget script if not already loaded
        if (!document.querySelector('script[src*="calendly.com"]')) {
          const script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = 'https://assets.calendly.com/assets/external/widget.js';
          script.async = true;
          document.body.appendChild(script);
        }
        // Scroll to Calendly
        setTimeout(() => {
          calendlySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      } else {
        form.reportValidity();
      }
    });

    // Listen for Calendly event when event is scheduled
    window.addEventListener('message', function(e) {
      if (e.data.event && e.data.event.indexOf('calendly') === 0) {
        if (e.data.event === 'calendly.event_scheduled') {
          // Redirect to confirmation/payment page after scheduling
          window.location.href = 'confirm.html';
        }
      }
    });

    // Place of Birth Autocomplete using Nominatim (OpenStreetMap)
    (function() {
      const input = document.getElementById('place-of-birth');
      const suggestionsContainer = document.getElementById('place-suggestions');
      let debounceTimer;
      let currentSuggestions = [];
      let selectedIndex = -1;

      if (!input || !suggestionsContainer) return;

      // Fetch suggestions from Nominatim API
      function fetchSuggestions(query) {
        if (query.length < 2) {
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          return;
        }

        // Use Nominatim API (free, no API key required)
        const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&addressdetails=1`;
        
        fetch(url, {
          headers: {
            'User-Agent': 'Life of Lotus Website'
          }
        })
        .then(response => response.json())
        .then(data => {
          currentSuggestions = data;
          displaySuggestions(data);
        })
        .catch(error => {
          console.error('Error fetching location suggestions:', error);
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
        });
      }

      // Display suggestions
      function displaySuggestions(suggestions) {
        if (suggestions.length === 0) {
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          return;
        }

        suggestionsContainer.innerHTML = suggestions.map((place, index) => {
          const displayName = place.display_name.split(',')[0] + ', ' + 
                             (place.address?.city || place.address?.town || place.address?.village || place.address?.state || place.address?.country || '');
          return `<div class="autocomplete-suggestion" data-index="${index}" data-place="${place.display_name}">${displayName}</div>`;
        }).join('');

        suggestionsContainer.style.display = 'block';
        selectedIndex = -1;
      }

      // Handle input typing with debounce
      input.addEventListener('input', function(e) {
        clearTimeout(debounceTimer);
        const query = e.target.value.trim();
        
        debounceTimer = setTimeout(() => {
          fetchSuggestions(query);
        }, 300);
      });

      // Handle suggestion click
      suggestionsContainer.addEventListener('click', function(e) {
        const suggestion = e.target.closest('.autocomplete-suggestion');
        if (suggestion) {
          const placeName = suggestion.getAttribute('data-place');
          input.value = placeName;
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          input.focus();
        }
      });

      // Handle keyboard navigation
      input.addEventListener('keydown', function(e) {
        if (suggestionsContainer.style.display === 'none' || currentSuggestions.length === 0) {
          return;
        }

        if (e.key === 'ArrowDown') {
          e.preventDefault();
          selectedIndex = Math.min(selectedIndex + 1, currentSuggestions.length - 1);
          updateSelectedSuggestion();
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          selectedIndex = Math.max(selectedIndex - 1, -1);
          updateSelectedSuggestion();
        } else if (e.key === 'Enter' && selectedIndex >= 0) {
          e.preventDefault();
          const placeName = currentSuggestions[selectedIndex].display_name;
          input.value = placeName;
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
        } else if (e.key === 'Escape') {
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          selectedIndex = -1;
        }
      });

      function updateSelectedSuggestion() {
        const suggestions = suggestionsContainer.querySelectorAll('.autocomplete-suggestion');
        suggestions.forEach((suggestion, index) => {
          if (index === selectedIndex) {
            suggestion.classList.add('selected');
            suggestion.scrollIntoView({ block: 'nearest' });
          } else {
            suggestion.classList.remove('selected');
          }
        });
      }

      // Close suggestions when clicking outside
      document.addEventListener('click', function(e) {
        if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
          suggestionsContainer.style.display = 'none';
        }
      });

      // Hide suggestions on blur (with delay to allow clicks)
      input.addEventListener('blur', function() {
        setTimeout(() => {
          suggestionsContainer.style.display = 'none';
        }, 200);
      });
    })();
  </script>

  <!-- Mobile Menu Script -->
  <script src="js/mobile-menu.js"></script>

</body>
</html>
