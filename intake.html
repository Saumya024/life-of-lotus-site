<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book a Vedic Astrology Consultation | I Read Space</title>
  <meta name="description" content="Book your Vedic astrology consultation with I Read Space. Share your birth details, select your session type, and schedule a time that works for you." />
  <link rel="canonical" href="https://lifeoflotus.in/intake" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/images/Radicle (4).png">
  <link rel="apple-touch-icon" href="assets/images/Radicle (4).png">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500&family=Brygada+1918:wght@400;500&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- Header -->
  <header class="header">
    <div class="logo">
      <img src="assets/images/Radicle (5) (1).png" alt="I Read Space" />
    </div>
    <div class="header-mobile-actions">
      <button class="hamburger" id="hamburger" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="nav" id="nav">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="index.html#pricing">Pricing</a>
      <a href="index.html#areas">Services</a>
      <a href="faq.html">FAQ</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </header>

  <!-- Intake Section -->
  <section class="intake">
    <div class="intake-container">
      <form class="intake-form" id="intake-form">
        <div class="intake-grid">
          
          <!-- First Section: Pricing/Package Card -->
          <div class="intake-section">
            <!-- Pricing Card (default, shown for pricing) -->
            <div class="pricing-card" id="pricing-card">
              <div class="pricing-duration">60-Minutes</div>
              <h3 class="pricing-name">Deep Insight</h3>
              <div class="pricing-best-for">Root-cause analysis | First-time consultations</div>
              <div class="pricing-toggle">
                <button type="button" class="toggle-btn active" data-type="audio">Audio</button>
                <button type="button" class="toggle-btn" data-type="video">Video</button>
              </div>
              <div class="pricing-price" data-audio-price="₹1,800" data-video-price="₹2,000">₹1,800</div>
              <div class="pricing-details">
                <div class="pricing-detail-item">Up to 3 related topics allowed</div>
                <div class="pricing-detail-item">2 charts covered</div>
              </div>
            </div>
            <!-- Package Card (hidden by default, shown for packages) -->
            <div class="package-card" id="package-card" style="display: none;">
              <div class="package-duration">60-Minutes <span class="package-sessions">× 3</span></div>
              <h3 class="package-name">Deep Insight</h3>
              <div class="package-toggle">
                <button type="button" class="toggle-btn active" data-type="audio">Audio</button>
                <button type="button" class="toggle-btn" data-type="video">Video</button>
              </div>
              <div class="package-original-price" data-audio-original="₹5,400" data-video-original="₹6,000">₹5,400</div>
              <div class="package-price" data-audio-price="₹4,800" data-video-price="₹5,400">₹4,800</div>
              <div class="package-savings" data-audio-savings="Save ₹600" data-video-savings="Save ₹600">Save ₹600</div>
              <div class="package-note">No expiry on sessions.</div>
            </div>
            <!-- Cal.com modal will be dynamically created after form submission -->
      </div>
  
          <!-- Second Section: Personal Information -->
          <div class="intake-section">
      <div class="field">
              <label>Name *</label>
              <input type="text" name="name" required />
      </div>
  
      <div class="field">
              <label>Email *</label>
              <input type="email" name="email" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Please enter a valid email address" />
              <span class="field-error" id="email-error"></span>
      </div>
  
      <div class="field">
              <label>Phone Number *</label>
              <input type="tel" name="phone" required pattern="[\d\s\+\-\(\)]+" title="Please enter a valid phone number with country code (7-15 digits)" maxlength="20" />
              <span class="field-error" id="phone-error"></span>
            </div>
      </div>
  
          <!-- Third Section: Birth Details -->
          <div class="intake-section">
      <div class="field">
              <label>Date of Birth *</label>
              <input type="date" name="dob" required id="dob-input" max="" />
              <span class="field-error" id="dob-error"></span>
      </div>
  
      <div class="field">
              <label>Time of Birth *</label>
              <input type="time" name="tob" required />
      </div>
  
      <div class="field">
              <label>Place of Birth *</label>
              <div class="autocomplete-wrapper">
                <input type="text" name="pob" id="place-of-birth" autocomplete="off" required />
                <div class="autocomplete-suggestions" id="place-suggestions"></div>
              </div>
      </div>
  
      <div class="field">
              <label>Primary Area of Guidance *</label>
              <select name="area" required>
                <option value="">Select an area</option>
          <option>Career & Finances</option>
          <option>Marriage & Relationships</option>
          <option>Health & Wellbeing</option>
          <option>Family & Children</option>
          <option>Personal / Spiritual Growth</option>
          <option>Open session</option>
        </select>
            </div>
          </div>
      </div>
  
        <!-- Optional Section -->
        <div class="intake-optional">
      <div class="field">
            <label>What feels most unclear right now? (Optional)</label>
            <textarea name="unclear" rows="4" id="unclear-textarea" maxlength="1000"></textarea>
            <div class="word-count"><span id="word-count-display">0</span> / 150 words</div>
            <span class="field-error" id="unclear-error"></span>
          </div>
      </div>
  
        <!-- CTA Button -->
        <div class="intake-cta-wrapper">
          <button class="cta" type="button" id="book-slot-btn">
            Book Slot
      </button>
        </div>
      </form>
  
      <!-- Booking link will be replaced with Cal.com -->
    </div>
  </section>
  
  <!-- Cal.com Booking Modal (dynamically created) -->
  <div id="cal-modal-overlay" style="display: none;">
    <div id="cal-modal">
      <button id="cal-modal-close" class="cal-modal-close" aria-label="Close">×</button>
      <p class="cal-modal-instruction"><strong>Please Note:</strong> Kindly ensure you select your time zone to book the right slot.</p>
      <div id="cal-modal-content"></div>
    </div>
  </div>

  <script>
    // Set max date for Date of Birth (today's date) and mark required fields as empty
    document.addEventListener('DOMContentLoaded', function() {
      const dobInput = document.getElementById('dob-input');
      if (dobInput) {
        const today = new Date();
        const maxDate = today.toISOString().split('T')[0];
        dobInput.setAttribute('max', maxDate);
        dobInput.max = maxDate; // Also set property directly for mobile compatibility
        // Explicitly mark DOB as empty
        if (!dobInput.value || dobInput.value === '') {
          dobInput.classList.add('required-empty');
        }
      }
      
      // Explicitly mark Time of Birth as empty
      const tobInput = document.querySelector('input[name="tob"]');
      if (tobInput && (!tobInput.value || tobInput.value === '')) {
        tobInput.classList.add('required-empty');
      }
      
      // Mark all required fields as empty on page load
      const requiredFields = document.querySelectorAll('.field input[required], .field select[required]');
      requiredFields.forEach(function(field) {
        // For date and time inputs, check if value is empty
        const isEmpty = !field.value || field.value === '' || (field.type === 'date' && field.value === '') || (field.type === 'time' && field.value === '');
        
        if (isEmpty) {
          field.classList.add('required-empty');
        }
        
        // Add event listeners to update classes on change
        field.addEventListener('change', function() {
          const hasValue = this.value && this.value !== '';
          if (hasValue) {
            this.classList.remove('required-empty');
            this.classList.add('required-filled');
          } else {
            this.classList.add('required-empty');
            this.classList.remove('required-filled');
          }
        });
        
        // For date/time inputs, also listen to input event
        if (field.type === 'date' || field.type === 'time') {
          field.addEventListener('input', function() {
            const hasValue = this.value && this.value !== '';
            if (hasValue) {
              this.classList.remove('required-empty');
              this.classList.add('required-filled');
            } else {
              this.classList.add('required-empty');
              this.classList.remove('required-filled');
            }
          });
        } else {
          field.addEventListener('input', function() {
            const hasValue = this.value && this.value !== '';
            if (hasValue) {
              this.classList.remove('required-empty');
              this.classList.add('required-filled');
            } else {
              this.classList.add('required-empty');
              this.classList.remove('required-filled');
            }
          });
        }
      });
    });

    // Cal.com Booking URLs
    const CAL_30_URL = 'https://cal.com/life-of-lotus/30min';
    const CAL_60_URL = 'https://cal.com/life-of-lotus/60min';
    const CAL_90_URL = 'https://cal.com/life-of-lotus/90min';

    // Pricing data for each duration
    const pricingData = {
      30: {
        duration: '30-Minutes',
        name: 'Quick Clarity',
        bestFor: 'Follow-up sessions | Focused queries | Quick clarity',
        audioPrice: '₹900',
        videoPrice: '₹1,100',
        details: [
          '1 key topic allowed',
          '1 chart covered'
        ]
      },
      60: {
        duration: '60-Minutes',
        name: 'Deep Insight',
        bestFor: 'Root-cause analysis | First-time consultations',
        audioPrice: '₹1,800',
        videoPrice: '₹2,000',
        details: [
          'Up to 3 related topics allowed',
          '2 charts covered'
        ]
      },
      90: {
        duration: '90-Minutes',
        name: 'Holistic Guidance',
        bestFor: 'In-depth life themes | Remedies & planning',
        audioPrice: '₹2,700',
        videoPrice: '₹2,900',
        details: [
          'Multiple life areas allowed',
          'Multiple charts covered'
        ]
      }
    };

    // Package data for each duration
    const packageData = {
      30: {
        duration: '30-Minutes',
        name: 'Quick Clarity',
        audioOriginal: '₹2,700',
        videoOriginal: '₹3,300',
        audioPrice: '₹2,400',
        videoPrice: '₹3,000',
        audioSavings: 'Save ₹300',
        videoSavings: 'Save ₹300'
      },
      60: {
        duration: '60-Minutes',
        name: 'Deep Insight',
        audioOriginal: '₹5,400',
        videoOriginal: '₹6,000',
        audioPrice: '₹4,800',
        videoPrice: '₹5,400',
        audioSavings: 'Save ₹600',
        videoSavings: 'Save ₹600'
      },
      90: {
        duration: '90-Minutes',
        name: 'Holistic Guidance',
        audioOriginal: '₹8,100',
        videoOriginal: '₹8,700',
        audioPrice: '₹7,200',
        videoPrice: '₹7,800',
        audioSavings: 'Save ₹900',
        videoSavings: 'Save ₹900'
      }
    };

    // Read duration and type from URL query parameters
    function getDurationFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const duration = urlParams.get('duration');
      // Validate duration, default to 60 if invalid
      if (duration === '30' || duration === '60' || duration === '90') {
        return parseInt(duration, 10);
      }
      return 60; // Default to 60 minutes
    }

    function getTypeFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('type'); // Returns 'package' or null
    }

    // Update pricing card based on duration
    function updatePricingCard(duration) {
      const data = pricingData[duration];
      if (!data) return;

      const card = document.getElementById('pricing-card');
      if (!card) return;

      // Update duration
      const durationElement = card.querySelector('.pricing-duration');
      if (durationElement) durationElement.textContent = data.duration;

      // Update name
      const nameElement = card.querySelector('.pricing-name');
      if (nameElement) nameElement.textContent = data.name;

      // Update best for
      const bestForElement = card.querySelector('.pricing-best-for');
      if (bestForElement) bestForElement.textContent = data.bestFor;

      // Update price
      const priceElement = card.querySelector('.pricing-price');
      if (priceElement) {
        priceElement.setAttribute('data-audio-price', data.audioPrice);
        priceElement.setAttribute('data-video-price', data.videoPrice);
        priceElement.textContent = data.audioPrice;
      }

      // Update details
      const detailsElements = card.querySelectorAll('.pricing-detail-item');
      if (detailsElements && detailsElements.length >= 2) {
        detailsElements[0].textContent = data.details[0];
        detailsElements[1].textContent = data.details[1];
      }

      // Reset toggle buttons to audio (default)
      const toggleButtons = card.querySelectorAll('.toggle-btn');
      toggleButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.type === 'audio') {
          btn.classList.add('active');
        }
      });
    }

    // Update package card based on duration
    function updatePackageCard(duration) {
      const data = packageData[duration];
      if (!data) return;

      const card = document.getElementById('package-card');
      if (!card) return;

      // Update duration
      const durationElement = card.querySelector('.package-duration');
      if (durationElement) {
        durationElement.innerHTML = `${data.duration} <span class="package-sessions">× 3</span>`;
      }

      // Update name
      const nameElement = card.querySelector('.package-name');
      if (nameElement) nameElement.textContent = data.name;

      // Update original price
      const originalPriceElement = card.querySelector('.package-original-price');
      if (originalPriceElement) {
        originalPriceElement.setAttribute('data-audio-original', data.audioOriginal);
        originalPriceElement.setAttribute('data-video-original', data.videoOriginal);
        originalPriceElement.textContent = data.audioOriginal;
      }

      // Update package price
      const priceElement = card.querySelector('.package-price');
      if (priceElement) {
        priceElement.setAttribute('data-audio-price', data.audioPrice);
        priceElement.setAttribute('data-video-price', data.videoPrice);
        priceElement.textContent = data.audioPrice;
      }

      // Update savings
      const savingsElement = card.querySelector('.package-savings');
      if (savingsElement) {
        savingsElement.setAttribute('data-audio-savings', data.audioSavings);
        savingsElement.setAttribute('data-video-savings', data.videoSavings);
        savingsElement.textContent = data.audioSavings;
      }

      // Reset toggle buttons to audio (default)
      const toggleButtons = card.querySelectorAll('.toggle-btn');
      toggleButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.type === 'audio') {
          btn.classList.add('active');
        }
      });
    }

    // Initialize page based on URL parameters
    // Ensure DOM is ready before updating
    function initializeCard() {
      const duration = getDurationFromURL();
      const type = getTypeFromURL();
      const pricingCard = document.getElementById('pricing-card');
      const packageCard = document.getElementById('package-card');

      if (type === 'package') {
        // Show package card, hide pricing card
        if (pricingCard) pricingCard.style.display = 'none';
        if (packageCard) {
          packageCard.style.display = 'block';
          updatePackageCard(duration);
        }
      } else {
        // Show pricing card, hide package card (default)
        if (packageCard) packageCard.style.display = 'none';
        if (pricingCard) {
          pricingCard.style.display = 'block';
          updatePricingCard(duration);
        }
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeCard);
    } else {
      // DOM is already ready
      initializeCard();
    }

    // Toggle button functionality with price updates
    document.querySelectorAll('.toggle-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const toggleGroup = this.parentElement;
        const card = toggleGroup.closest('.pricing-card, .package-card');
        const isVideo = this.dataset.type === 'video';
        
        // Update toggle active state
        toggleGroup.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // Update pricing card prices
        if (card && card.classList.contains('pricing-card')) {
          const priceElement = card.querySelector('.pricing-price');
          if (priceElement) {
            const audioPrice = priceElement.dataset.audioPrice;
            const videoPrice = priceElement.dataset.videoPrice;
            if (audioPrice && videoPrice) {
              priceElement.textContent = isVideo ? videoPrice : audioPrice;
            }
          }
        }
        
        // Update package card prices, original prices, and savings
        if (card && card.classList.contains('package-card')) {
          const originalPriceElement = card.querySelector('.package-original-price');
          const priceElement = card.querySelector('.package-price');
          const savingsElement = card.querySelector('.package-savings');
          
          if (originalPriceElement) {
            const audioOriginal = originalPriceElement.dataset.audioOriginal;
            const videoOriginal = originalPriceElement.dataset.videoOriginal;
            if (audioOriginal && videoOriginal) {
              originalPriceElement.textContent = isVideo ? videoOriginal : audioOriginal;
            }
          }
          
          if (priceElement) {
            const audioPrice = priceElement.dataset.audioPrice;
            const videoPrice = priceElement.dataset.videoPrice;
            if (audioPrice && videoPrice) {
              priceElement.textContent = isVideo ? videoPrice : audioPrice;
            }
          }
          
          if (savingsElement) {
            const audioSavings = savingsElement.dataset.audioSavings;
            const videoSavings = savingsElement.dataset.videoSavings;
            if (audioSavings && videoSavings) {
              savingsElement.textContent = isVideo ? videoSavings : audioSavings;
            }
          }
        }
      });
    });

    // Track iframe creation to ensure it's created only once per page load
    let calIframeCreated = false;

    // Validation functions
    function validateEmail(email) {
      const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      return emailRegex.test(email);
    }

    function validatePhone(phone) {
      // Remove spaces, dashes, parentheses for validation
      const cleaned = phone.replace(/[\s\-\(\)]/g, '');
      // Must start with + or digit, contain only digits after that
      const phoneRegex = /^[\+]?[\d]{7,15}$/;
      return phoneRegex.test(cleaned) && cleaned.length >= 7 && cleaned.length <= 15;
    }

    function validateDateOfBirth(dob) {
      const selectedDate = new Date(dob);
      const today = new Date();
      today.setHours(23, 59, 59, 999); // Set to end of today
      return selectedDate <= today;
    }

    function countWords(text) {
      if (!text || text.trim() === '') return 0;
      return text.trim().split(/\s+/).filter(word => word.length > 0).length;
    }

    function showError(fieldId, message) {
      const errorElement = document.getElementById(fieldId + '-error');
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
      }
    }

    function clearError(fieldId) {
      const errorElement = document.getElementById(fieldId + '-error');
      if (errorElement) {
        errorElement.textContent = '';
        errorElement.style.display = 'none';
      }
    }

    // Word count for textarea
    const unclearTextarea = document.getElementById('unclear-textarea');
    const wordCountDisplay = document.getElementById('word-count-display');
    if (unclearTextarea && wordCountDisplay) {
      unclearTextarea.addEventListener('input', function() {
        const wordCount = countWords(this.value);
        wordCountDisplay.textContent = wordCount;
        
        if (wordCount > 150) {
          showError('unclear', 'Maximum 150 words allowed');
          wordCountDisplay.style.color = '#d32f2f';
        } else {
          clearError('unclear');
          wordCountDisplay.style.color = 'inherit';
        }
      });
    }

    // Real-time validation for email
    const emailInput = document.querySelector('input[name="email"]');
    if (emailInput) {
      emailInput.addEventListener('blur', function() {
        if (this.value && !validateEmail(this.value)) {
          showError('email', 'Please enter a valid email address');
        } else {
          clearError('email');
        }
      });
      emailInput.addEventListener('input', function() {
        if (this.value && validateEmail(this.value)) {
          clearError('email');
        }
      });
    }

    // Real-time validation for phone
    const phoneInput = document.querySelector('input[name="phone"]');
    if (phoneInput) {
      // Add input event listener for real-time validation on mobile
      phoneInput.addEventListener('input', function() {
        // Remove non-digit characters except + for length check
        const cleaned = this.value.replace(/[^\d+]/g, '');
        // Limit to 20 characters total (including formatting)
        if (this.value.length > 20) {
          this.value = this.value.slice(0, 20);
        }
        // Validate if value exists
        if (this.value && validatePhone(this.value)) {
          clearError('phone');
        } else if (this.value && cleaned.length > 15) {
          showError('phone', 'Phone number should be 7-15 digits');
        } else if (this.value && cleaned.length < 7) {
          // Don't show error while typing, only on blur
          clearError('phone');
        }
      });
      phoneInput.addEventListener('blur', function() {
        if (this.value && !validatePhone(this.value)) {
          showError('phone', 'Please enter a valid phone number with country code (7-15 digits)');
        } else {
          clearError('phone');
        }
      });
    }

    // Real-time validation for date of birth
    const dobInput = document.getElementById('dob-input');
    if (dobInput) {
      // Set max date immediately on page load (before DOMContentLoaded if possible)
      const today = new Date();
      const maxDate = today.toISOString().split('T')[0];
      dobInput.max = maxDate;
      dobInput.setAttribute('max', maxDate);
      
      // Validate on change (for desktop)
      dobInput.addEventListener('change', function() {
        if (this.value && !validateDateOfBirth(this.value)) {
          showError('dob', 'Date of birth cannot be in the future');
          this.value = ''; // Clear invalid date
        } else {
          clearError('dob');
        }
      });
      
      // Also validate on input (for mobile date pickers)
      dobInput.addEventListener('input', function() {
        if (this.value && !validateDateOfBirth(this.value)) {
          showError('dob', 'Date of birth cannot be in the future');
          this.value = ''; // Clear invalid date
        } else {
          clearError('dob');
        }
      });
    }

    // Book Slot button - open modal with Cal.com iframe after form submission
    document.getElementById('book-slot-btn').addEventListener('click', function(e) {
      e.preventDefault();
      
      // Clear previous errors
      clearError('email');
      clearError('phone');
      clearError('dob');
      clearError('unclear');
      
      // Validate form first
      const form = document.getElementById('intake-form');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      // Read form values
      const formData = new FormData(form);
      const name = formData.get('name');
      const email = formData.get('email');
      const phone = formData.get('phone');
      const dob = formData.get('dob');
      const unclear = formData.get('unclear');
      
      // Validate required fields
      if (!name || !email) {
        form.reportValidity();
        return;
      }
      
      // Custom validation for email
      if (!validateEmail(email)) {
        showError('email', 'Please enter a valid email address');
        emailInput.focus();
        return;
      }
      
      // Custom validation for phone
      if (!validatePhone(phone)) {
        showError('phone', 'Please enter a valid phone number with country code (7-15 digits)');
        phoneInput.focus();
        return;
      }
      
      // Custom validation for date of birth
      if (dob && !validateDateOfBirth(dob)) {
        showError('dob', 'Date of birth cannot be in the future');
        dobInput.focus();
        return;
      }
      
      // Validate word count for optional textarea
      if (unclear) {
        const wordCount = countWords(unclear);
        if (wordCount > 150) {
          showError('unclear', 'Maximum 150 words allowed');
          unclearTextarea.focus();
          return;
        }
      }
      
      // Get modal elements
      const modalOverlay = document.getElementById('cal-modal-overlay');
      const modalContent = document.getElementById('cal-modal-content');
      
      // Only create iframe once per page load
      if (!calIframeCreated && modalContent) {
        // Determine duration from pricing card or package card
        const pricingDurationElement = document.querySelector('.pricing-duration');
        const packageDurationElement = document.querySelector('.package-duration');
        const durationElement = pricingDurationElement || packageDurationElement;
        let duration = 60; // Default to 60 minutes
        if (durationElement) {
          const durationText = durationElement.textContent.trim();
          const durationMatch = durationText.match(/(\d+)/);
          if (durationMatch) {
            duration = parseInt(durationMatch[1], 10);
          }
        }
        
        // Get the matching Cal.com URL
        let calUrl;
        if (duration === 30) {
          calUrl = CAL_30_URL;
        } else if (duration === 60) {
          calUrl = CAL_60_URL;
        } else if (duration === 90) {
          calUrl = CAL_90_URL;
        } else {
          calUrl = CAL_60_URL; // Default to 60 minutes
        }
        
        // URL-encode name and email
        const encodedName = encodeURIComponent(name);
        const encodedEmail = encodeURIComponent(email);
        
        // Construct Cal.com URL with query parameters
        const calUrlWithParams = `${calUrl}?name=${encodedName}&email=${encodedEmail}`;
        
        // Create and inject Cal.com iframe (only once)
        const iframe = document.createElement('iframe');
        iframe.src = calUrlWithParams;
        iframe.setAttribute('frameborder', '0');
        iframe.setAttribute('allowtransparency', 'true');
        iframe.setAttribute('allow', 'geolocation; microphone; camera');
        iframe.id = 'cal-booking-iframe'; // Add ID for reference
        
        // Inject iframe into modal content
        modalContent.appendChild(iframe);
        
        // Mark iframe as created - never create again
        calIframeCreated = true;
      }
      
      // Show modal (iframe persists if already created)
      if (modalOverlay) {
        modalOverlay.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Prevent body scrolling
      }
    });

    // Close modal functionality
    const modalOverlay = document.getElementById('cal-modal-overlay');
    const modalClose = document.getElementById('cal-modal-close');

    // Close button click
    if (modalClose) {
      modalClose.addEventListener('click', function() {
        if (modalOverlay) {
          modalOverlay.style.display = 'none';
          document.body.style.overflow = ''; // Restore body scrolling
        }
      });
    }

    // Close on overlay click (outside modal)
    if (modalOverlay) {
      modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
          modalOverlay.style.display = 'none';
          document.body.style.overflow = ''; // Restore body scrolling
        }
      });
    }

    // Close on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && modalOverlay && modalOverlay.style.display === 'flex') {
        modalOverlay.style.display = 'none';
        document.body.style.overflow = ''; // Restore body scrolling
      }
    });

    // Place of Birth Autocomplete using Nominatim (OpenStreetMap)
    (function() {
      const input = document.getElementById('place-of-birth');
      const suggestionsContainer = document.getElementById('place-suggestions');
      let debounceTimer;
      let currentSuggestions = [];
      let selectedIndex = -1;

      if (!input || !suggestionsContainer) return;

      // Fetch suggestions from Nominatim API
      function fetchSuggestions(query) {
        if (query.length < 2) {
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          return;
        }

        // Use Nominatim API (free, no API key required)
        const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&addressdetails=1`;
        
        fetch(url, {
          headers: {
            'User-Agent': 'I Read Space Website'
          }
        })
        .then(response => response.json())
        .then(data => {
          currentSuggestions = data;
          displaySuggestions(data);
        })
        .catch(error => {
          console.error('Error fetching location suggestions:', error);
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
        });
      }

      // Display suggestions
      function displaySuggestions(suggestions) {
        if (suggestions.length === 0) {
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          return;
        }

        suggestionsContainer.innerHTML = suggestions.map((place, index) => {
          const displayName = place.display_name.split(',')[0] + ', ' + 
                             (place.address?.city || place.address?.town || place.address?.village || place.address?.state || place.address?.country || '');
          return `<div class="autocomplete-suggestion" data-index="${index}" data-place="${place.display_name}">${displayName}</div>`;
        }).join('');

        suggestionsContainer.style.display = 'block';
        selectedIndex = -1;
      }

      // Handle input typing with debounce
      input.addEventListener('input', function(e) {
        clearTimeout(debounceTimer);
        const query = e.target.value.trim();
        
        debounceTimer = setTimeout(() => {
          fetchSuggestions(query);
        }, 300);
      });

      // Handle suggestion click
      suggestionsContainer.addEventListener('click', function(e) {
        const suggestion = e.target.closest('.autocomplete-suggestion');
        if (suggestion) {
          const placeName = suggestion.getAttribute('data-place');
          input.value = placeName;
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          input.focus();
        }
      });

      // Handle keyboard navigation
      input.addEventListener('keydown', function(e) {
        if (suggestionsContainer.style.display === 'none' || currentSuggestions.length === 0) {
          return;
        }

        if (e.key === 'ArrowDown') {
          e.preventDefault();
          selectedIndex = Math.min(selectedIndex + 1, currentSuggestions.length - 1);
          updateSelectedSuggestion();
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          selectedIndex = Math.max(selectedIndex - 1, -1);
          updateSelectedSuggestion();
        } else if (e.key === 'Enter' && selectedIndex >= 0) {
          e.preventDefault();
          const placeName = currentSuggestions[selectedIndex].display_name;
          input.value = placeName;
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
        } else if (e.key === 'Escape') {
          suggestionsContainer.innerHTML = '';
          suggestionsContainer.style.display = 'none';
          selectedIndex = -1;
        }
      });

      function updateSelectedSuggestion() {
        const suggestions = suggestionsContainer.querySelectorAll('.autocomplete-suggestion');
        suggestions.forEach((suggestion, index) => {
          if (index === selectedIndex) {
            suggestion.classList.add('selected');
            suggestion.scrollIntoView({ block: 'nearest' });
          } else {
            suggestion.classList.remove('selected');
          }
        });
      }

      // Close suggestions when clicking outside
      document.addEventListener('click', function(e) {
        if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
          suggestionsContainer.style.display = 'none';
        }
      });

      // Hide suggestions on blur (with delay to allow clicks)
      input.addEventListener('blur', function() {
        setTimeout(() => {
          suggestionsContainer.style.display = 'none';
        }, 200);
      });
    })();
  </script>

  <!-- Mobile Menu Script -->
  <script src="js/mobile-menu.js"></script>

</body>
</html>
